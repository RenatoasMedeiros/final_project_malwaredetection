import pandas as pd
import matplotlib.pyplot as plt
import os

# Function to find the best fold based on minimum validation loss for each file
def find_best_fold(directory):
    best_folds = {}
    
    csv_directory = os.path.join(directory, 'CSV')
    
    for file in os.listdir(csv_directory):
        if file.endswith('.csv'):
            file_path = os.path.join(csv_directory, file)
            df = pd.read_csv(file_path)
            min_loss_fold = df.loc[df['val_loss'].idxmin()]
            best_folds[file] = min_loss_fold['fold']
    
    return best_folds

nome = "Flatten Crossval Hyperbolic Tangent"
# Function to plot the evolution of validation accuracy for the best fold per file
def plot_accuracy_evolution_best_fold(directory, best_folds, custom_labels=None, Nome=nome):
    colors = ['b', 'g', 'r', 'c', 'm', 'y', 'k']  # List of colors for each file
    
    plt.figure(figsize=(10, 6))
    
    csv_directory = os.path.join(directory, 'CSV')
    
    for idx, (file, best_fold) in enumerate(best_folds.items()):
        file_path = os.path.join(csv_directory, file)
        df = pd.read_csv(file_path)
        fold_data = df[df['fold'] == best_fold]
        epochs = fold_data['epoch']
        val_accuracy = fold_data['val_accuracy']
        color = colors[idx % len(colors)]
        label = custom_labels[idx] if custom_labels else f'{file} - Fold {best_fold} - Validation Accuracy'
        plt.plot(epochs, val_accuracy, label=label, color=color)
    

    plt.title('Validation Accuracy '+ nome)
    plt.xlabel('Epoch')
    plt.ylabel('Validation Accuracy')
    plt.legend()
    plt.grid(True)
    plt.tight_layout()
    plt.show()

# Function to plot the evolution of validation loss for the best fold per file
def plot_loss_evolution_best_fold(directory, best_folds, custom_labels=None,Nome=nome):
    colors = ['b', 'g', 'r', 'c', 'm', 'y', 'k']  # List of colors for each file
    
    plt.figure(figsize=(10, 6))
    
    csv_directory = os.path.join(directory, 'CSV')
    
    for idx, (file, best_fold) in enumerate(best_folds.items()):
        file_path = os.path.join(csv_directory, file)
        df = pd.read_csv(file_path)
        fold_data = df[df['fold'] == best_fold]
        epochs = fold_data['epoch']
        val_loss = fold_data['val_loss']
        color = colors[idx % len(colors)]
        if custom_labels:
            label = f'{custom_labels[idx]} - Fold {best_fold}'
        # label = custom_labels[idx] if custom_labels else f'{file} - Fold {best_fold} - Validation Loss'
        plt.plot(epochs, val_loss, label=label, color=color)

    plt.title('Validation Loss ' + nome)
    plt.xlabel('Epoch')
    plt.ylabel('Validation Loss')
    plt.legend()
    plt.grid(True)
    plt.tight_layout()
    plt.show()

# Provide the directory containing your project
project_directory = './Training/Flatten_CrossVal_All_Done/Hyperbolic Tangent'

nome = "Flatten Crossval Hyperbolic Tangent"
# Find the best fold per file
best_folds = find_best_fold(project_directory)

# Define custom labels (optional)
custom_labels = ['Dense 1 - 800 Dense 2 - 250', 'Dense 1 - 800', 'Dense 1 - 1350', 'Dense 2 - 250']

# Plot the evolution of validation accuracy for the best fold per file
plot_accuracy_evolution_best_fold(project_directory, best_folds, custom_labels,nome)

# Plot the evolution of validation loss for the best fold per file
plot_loss_evolution_best_fold(project_directory, best_folds, custom_labels,nome)
