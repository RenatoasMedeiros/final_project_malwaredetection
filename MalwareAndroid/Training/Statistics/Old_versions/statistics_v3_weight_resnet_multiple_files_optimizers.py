import pandas as pd
import matplotlib.pyplot as plt
import os

# Function to process CSV files and extract median validation accuracy and loss for each optimizer
def process_csv(csv_files):
    median_metrics = {'val_accuracy': {}, 'val_loss': {}}

    # Read and process each CSV file
    for csv_file in csv_files:
        optimizer_name = os.path.basename(csv_file).split('_')[-1].split('.')[0]
        df = pd.read_csv(csv_file)

        # Calculate median validation accuracy and loss across folds
        median_val_accuracy = df.groupby('optimizer')['val_accuracy'].median()
        median_val_loss = df.groupby('optimizer')['val_loss'].median()

        median_metrics['val_accuracy'][optimizer_name] = median_val_accuracy
        median_metrics['val_loss'][optimizer_name] = median_val_loss

    return median_metrics

# Function to plot median validation accuracy and loss for each optimizer
def plot_median_metrics(median_metrics):
    # Plot median validation accuracy
    plt.figure(figsize=(10, 6))
    for optimizer_name, val_accuracy in median_metrics['val_accuracy'].items():
        plt.plot(val_accuracy.index, val_accuracy.values, marker='o', label=optimizer_name)
    plt.xlabel('Optimizer')
    plt.ylabel('Median Validation Accuracy')
    plt.title('Median Validation Accuracy Across Optimizers')
    plt.xticks(rotation=45)
    plt.legend()
    plt.grid(True)
    plt.show()

    # Plot median validation loss
    plt.figure(figsize=(10, 6))
    for optimizer_name, val_loss in median_metrics['val_loss'].items():
        plt.plot(val_loss.index, val_loss.values, marker='o', label=optimizer_name)
    plt.xlabel('Optimizer')
    plt.ylabel('Median Validation Loss')
    plt.title('Median Validation Loss Across Optimizers')
    plt.xticks(rotation=45)
    plt.legend()
    plt.grid(True)
    plt.show()

# List of CSV files containing training data for different optimizers
csv_files = [
    'resnet50_crossval_history_model_adadelta.csv',
    'resnet50_crossval_history_model_adamax.csv',
    'resnet50_crossval_history_model_ftrl.csv',
    'resnet50_crossval_history_model_nadam.csv',
]

# Process CSV files and extract median validation accuracy and loss for each optimizer
median_metrics = process_csv(csv_files)

# Plot median validation accuracy and loss for each optimizer
plot_median_metrics(median_metrics)
